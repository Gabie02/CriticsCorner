{% extends "review/index.html" %}

<head>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <meta charset="UTF-8">
    {% load static %}
    {% block title %} {{ movie.title}} {% endblock %}
</head>

<body>
{% block content %}

<div class="details-card">
    <div id="details_poster">
        <img id="details-poster" src="{{movie.poster_url }}">
    </div>
    <br>
    <div id="details-info">
        <h1><b>{{ movie.title }}</b></h1>
        <button id="add-to-watchlist-btn">Add to Watchlist</button>
        <form id="add-to-watchlist-form" method="post" action="{% url 'review:add_to_watchlist' movie_id=movie.id %}">
            {% csrf_token %}
            <select name="watchlist_id" id="watchlist-select" style="display: none;">
                {% for watchlist in watchlists %}
                <option value="{{ watchlist.id }}">{{ watchlist.name }}</option>
                {% endfor %}
            </select>
            <button type="submit">Submit</button>
        </form>

        <script>
            const form = document.getElementById("add-to-watchlist-form");
            const watchlistSelect = document.getElementById("watchlist-select");
            const addToWatchlistBtn = document.getElementById("add-to-watchlist-btn");

            addToWatchlistBtn.addEventListener("click", (event) => {
                event.preventDefault();
                form.style.display = "block";
                watchlistSelect.style.display = "block";
            });
        </script>

        <ul id="basic-info">
            <li>{{movie.year}}</li>
            <li> {{movie.genres}}</li>
            <li>Rating: {{movie.avg_rating}} ★</li>
            <br><br>
            <p>{{movie.plot}}</p>
        </ul>

        <ul id="crew-info">
            <li>Directed by: {{movie.director}}</li>
            <br>
            <li>Written by: {{movie.writer}}</li>
            <br><br>
        </ul>
    </div>
</div>

<div id="details-review" class="container-fluid">

    <form id="review-form" method="post" action="{% url 'review:review_movie' movie_id=movie.id %}">
        {% csrf_token %}

        <div id="details-rating">
            <label for="rating">Rating</label> <br>
            <select name="rating" id="rating">
                <option value="1">1★</option>
                <option value="2">2★</option>
                <option value="3">3★</option>
                <option value="4">4★</option>
                <option value="5">5★</option>
                <option value="6">6★</option>
                <option value="7">7★</option>
                <option value="8">8★</option>
                <option value="9">9★</option>
                <option value="10">10★</option>
            </select>
        </div>
        <br>

        <div class="mt-3 d-flex flex-row align-items-center p-3 form-color">
            {% if request.user.reviewer.profile_picture == "" %}
            <img src="{% static 'images/default.png' %}" width="50" class="rounded-circle mr-2">
            {% else %}
            <img src="{% static request.user.reviewer.profile_picture %}" width="50" class="rounded-circle mr-2">
            {% endif %}
            <input type="text" class="form-control" style="width: 81%; margin-left: 5px"
                   placeholder="Enter your review...">
        </div>
    </form>
    <br><br>

    <script>
        $(function () {
            $('#rating').on('change', function () {
                $('#review-form').submit();
            });
        });
    </script>
</div>
<div id=details-list-users-reviews>
    {% if reviews %}
    <label>Reviews</label> <br>

    <div id="details-list-users-reviews-container">
        <!--        <div class="flex-row">-->
        <!--            {% for review in reviews %}-->
        <!--            <span>Rating: </span> {{ review.rating }}-->
        <!--            <span>-->
        <!--                    {{ review.likes_count }}-->
        <!--                    <a href="{% url 'review:like_movie' review_id=review.id %}">-->
        <!--                        <img src="{% static 'images/like.png' %}" alt="Like img" style="width: 25px"/>-->
        <!--                    </a>-->
        <!--            </span><br>-->
        <!--            <span>Comment: </span>{{ review.comment }}-->
        <!--            {% endfor %}-->
        <!--        </div>-->
        {% for review in reviews %}
        <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex flex-row align-items-center">
                {% if review.reviewer.profile_picture == "" %}
                <img src="{% static 'images/default.png' %}" width="40" class="rounded-circle mr-2">
                {% else %}
                <img src="{% static review.reviewer.profile_picture %}" width="40" class="rounded-circle mr-2">
                {% endif %}
                <span class="mr-2" style="margin-left: 10px">{{ review.reviewer.user.username }}</span>
                <small class="c-badge"><strong>Critic Certified</strong></small>
            </div>
            <small>{{ review.created_at }}</small>
        </div>
        <div class="container">

        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>No reviews yet.</p>
    {% endif %}

</div>
</div>
{% endblock %}

</body>